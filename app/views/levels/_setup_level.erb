FiercePlanet.currentLevel = new Level(<%= @level.id %>);
FiercePlanet.currentLevel.setName("<%= @level.name %>");
FiercePlanet.currentLevel.setWorldWidth(<%= @level.world_width %>);
FiercePlanet.currentLevel.setWorldHeight(<%= @level.world_height %>);
FiercePlanet.currentLevel.setIntroduction("<%= @level.notice %>");
FiercePlanet.currentLevel.setInitialAgentNumber(<%= @level.initial_agent_number %>);
FiercePlanet.currentLevel.setWaveNumber(<%= @level.wave_number %>);
FiercePlanet.currentLevel.setExpiryLimit(<%= @level.expiry_limit %>);
FiercePlanet.currentLevel.setAllowOffscreenCycling(<%= @level.allow_offscreen_cycling %>);
FiercePlanet.currentLevel.setAllowResourcesOnPath(<%= @level.allow_patches_on_path %>);
FiercePlanet.currentLevel.setMapURL("<%= @level.image_src %>");
FiercePlanet.currentLevel.setMapOptions({
<%= raw 'latitude: "' + @level.google_map_lat + '",' unless @level.google_map_lat.nil? or @level.google_map_lat.empty? %>
<%= raw 'longitude: "' + @level.google_map_long + '",' unless @level.google_map_long.nil? or @level.google_map_long.empty? %>
<%= raw 'tilt: "' + @level.google_map_tilt + '",' unless @level.google_map_tilt.nil? or @level.google_map_tilt.empty? %>
<%= raw 'zoom: "' + @level.google_map_zoom + '",' unless @level.google_map_zoom.nil? or @level.google_map_zoom.empty? %>
});
FiercePlanet.currentLevel.setCustomLevel(true);
FiercePlanet.currentLevel.setupLevel = function() {};
FiercePlanet.currentLevelNumber = <%= @level.id %>;
FiercePlanet.currentLevelPreset = false;
var arr = [];
var jsonArray = '<%= raw @level.tiles %>';
try {
    arr = $.evalJSON(jsonArray);
    FiercePlanet.currentLevel.setTiles(arr);
}
catch (err) {
    arr = FiercePlanet.currentLevel.fillWithTiles();
}

var jsonArray = '<%= raw @level.resources %>';
arr = [];
try {
    arr = $.evalJSON(jsonArray);
    arr.forEach(function(resource) {
        resource.getCategory = Resource.prototype.getCategory;
        resource.getX = Resource.prototype.getX;
        resource.getY = Resource.prototype.getY;
        resource._resourceCategory.getCode = ResourceCategory.prototype.getCode;
    });
    FiercePlanet.currentLevel.setLevelResources(arr);
}
catch (err) {
    if (window.console)
        console.log(err);
}

jsonArray = '<%= raw @level.entry_points %>';
arr = [];
try {
    arr = $.evalJSON(jsonArray);
}
catch (err) {
    if (window.console)
        console.log(err);
}
FiercePlanet.currentLevel.setEntryPoints(arr);

jsonArray = '<%= raw @level.exit_points %>';
arr = [];
try {
arr = $.evalJSON(jsonArray);
}
catch (err) {
    if (window.console)
        console.log(err);
}
FiercePlanet.currentLevel.setExitPoints(arr);
