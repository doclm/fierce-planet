<%= form_for @level, :method => :put, :remote => true do |f| %>
    <%= f.hidden_field :tiles %>
    <%= f.hidden_field :resources %>
    <%= f.hidden_field :entry_points %>
    <%= f.hidden_field :exit_points %>
    <%= f.submit 'Save Level' %>
<% end %>
<script>
    // attach a submit handler to the form
    $('.edit_level')[0].addEventListener('submit', function(event) {
        serializeLevel();
    });

    var levelTimerId = null;

    $(document).ready(function() {
        if (levelTimerId != undefined)
            clearInterval(levelTimerId);
        levelTimerId = setInterval("submitLevelForm()", 5000);
    });

    function submitLevelForm() {
        if (FiercePlanet.inDesignMode) {
            serializeLevel();
            try {
                $.rails.handleRemote($('.edit_level'));
            }
            catch(err) {
            }
        }
    }

    function serializeLevel() {
        $('#level_tiles')[0].value = $.toJSON(FiercePlanet.currentLevel.getTiles());
        $('#level_resources')[0].value = $.toJSON(FiercePlanet.currentLevel.getResources());
        $('#level_entry_points')[0].value = $.toJSON(FiercePlanet.currentLevel.getEntryPoints());
        $('#level_exit_points')[0].value = $.toJSON(FiercePlanet.currentLevel.getExitPoints());
    }
</script>

